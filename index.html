<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FRESHBULK PRESTIGE V3 - ISMAEL EL GRINGO</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="no-scroll">

    <div id="notif-container"></div>
    <div class="bg-fixed"></div>
    <div class="bg-overlay"></div>

    <!-- CONNEXION (RETROUVÉ À L'IDENTIQUE) -->
    <section id="login-screen" class="d-flex align-items-center justify-content-center vh-100 p-3">
        <div class="login-box shadow-lg w-100" style="max-width: 400px;">
            <img src="assets/logo.png" alt="Logo" class="login-logo mb-3" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1261/1261163.png'">
            <h1 class="fw-900 text-emerald mb-0 fs-2">FRESHBULK</h1>
            <p class="text-dark fw-bold ls-3 mb-4 small">PREMIUM SYSTEM</p>
            
            <div class="text-start mb-3">
                <label class="label-pro text-dark">PROPRIÉTAIRE</label>
                <input type="text" class="form-control login-input bg-light" value="ISMAEL EL GRINGO" readonly>
            </div>

            <div class="text-start mb-4">
                <label class="label-pro text-dark">CODE D'ACCÈS PRO</label>
                <div class="input-group group-pass">
                    <input type="password" id="pass" class="form-control login-input border-end-0" placeholder="••••••••">
                    <span class="input-group-text bg-white border-start-0 cursor-pointer" onclick="togglePassword()">
                        <i class="bi bi-eye-slash" id="toggleIcon"></i>
                    </span>
                </div>
            </div>
            <button onclick="checkAccess()" class="btn-god shadow">DÉVERROUILLER L'ACCÈS</button>
        </div>
    </section>

    <!-- APP PRINCIPALE -->
    <main id="app-screen" class="d-none h-100 overflow-auto">
        <nav class="navbar navbar-dark bg-emerald-glass py-2 px-3 px-md-5 shadow sticky-top">
            <span class="navbar-brand fw-800 fs-4 text-white">FRESHBULK <span class="text-dark">SERVICE</span></span>
            <div class="d-flex align-items-center">
                <div class="text-end me-3 d-none d-md-block">
                    <div class="text-white-50 small fw-bold" style="font-size: 10px;">SYSTÈME ACTIF</div>
                    <div class="text-white fw-800">ISMAEL EL GRINGO</div>
                </div>
                <button onclick="location.reload()" class="btn btn-dark btn-sm rounded-pill px-3">QUITTER</button>
            </div>
        </nav>

        <div class="container-fluid p-2 p-md-4">
            <div class="row g-4">
                <div class="col-12 col-lg-9">
                    
                    <!-- NOUVEAU : BOUTON HISTORIQUE MOBILE -->
                    <button class="btn btn-warning w-100 mb-3 d-lg-none fw-bold shadow-sm py-2" data-bs-toggle="modal" data-bs-target="#historyModal">
                        <i class="bi bi-clock-history me-2"></i> VOIR L'HISTORIQUE DES FACTURES
                    </button>

                    <div class="glass-panel p-3 p-md-4 shadow-lg">
                        <div class="row g-2 mb-4">
                            <div class="col-6 col-md-3">
                                <label class="label-pro">N° FACTURE</label>
                                <input type="text" id="f-num" class="form-control pro-input-soft fw-bold text-center" value="001">
                            </div>
                            <div class="col-6 col-md-3">
                                <label class="label-pro">DATE</label>
                                <input type="date" id="f-date" class="form-control pro-input-soft">
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="label-pro">NOM DU CLIENT</label>
                                <input type="text" id="client" class="form-control pro-input-soft fw-bold uppercase" placeholder="DESTINATAIRE">
                            </div>
                        </div>

                        <div class="table-responsive border rounded-3 mb-3 shadow-sm custom-scroll-container">
                            <table class="table align-middle mb-0" id="main-table">
                                <thead class="table-dark">
                                    <tr>
                                        <th class="col-desig">DÉSIGNATION</th>
                                        <th class="col-cond text-center">COND.</th>
                                        <th class="col-prix text-center">PRIX / COND.</th>
                                        <th class="col-total text-end">TOTAL</th>
                                        <th style="width: 40px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="rows" class="bg-white"></tbody>
                            </table>
                        </div>
                        
                        <button onclick="addRow()" class="btn-add-dashed w-100 mb-4 py-2">
                            <i class="bi bi-plus-circle-fill me-2"></i> AJOUTER UN PRODUIT
                        </button>

                        <div class="banner-total d-flex justify-content-between align-items-center p-3 rounded-4">
                            <div class="flex-grow-1 me-3">
                                <span class="text-muted small fw-bold">ARRÊTÉ À :</span>
                                <div id="total-words" class="fw-bold text-emerald text-uppercase" style="font-size: 0.75rem;">...</div>
                            </div>
                            <div class="text-end">
                                <span class="text-muted small fw-bold">NET À PAYER</span>
                                <div id="grand-total" class="fw-900 fs-2 text-dark text-nowrap">0 FCFA</div>
                            </div>
                        </div>

                        <button onclick="preVisualise()" class="btn-god mt-4 py-3 shadow-lg fs-5">
                            <i class="bi bi-eye-fill me-2"></i> PRÉVISUALISER
                        </button>
                    </div>
                </div>

                <!-- HISTORIQUE PC -->
                <div class="col-12 col-lg-3 d-none d-lg-block">
                    <div class="glass-panel p-3 h-100 shadow-sm">
                        <h6 class="fw-800 text-emerald border-bottom pb-2">HISTORIQUE DES VENTES</h6>
                        <div id="history-box-pc" class="history-scroll mt-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- MODAL HISTORIQUE MOBILE -->
    <div class="modal fade" id="historyModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 rounded-4">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title fw-bold">HISTORIQUE</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-2">
                    <div id="history-box-mobile" class="history-scroll"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PREVIEW -->
    <div class="modal fade" id="previewModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content border-0 rounded-4">
                <div class="modal-header bg-dark text-white border-0">
                    <h5 class="modal-title fw-bold">VÉRIFICATION FACTURE</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0 bg-secondary" style="height: 80vh;">
                    <iframe id="pdf-viewer" width="100%" height="100%" frameborder="0"></iframe>
                </div>
                <div class="modal-footer bg-white border-0">
                    <button class="btn btn-outline-secondary px-4 rounded-pill fw-bold" data-bs-dismiss="modal">MODIFIER</button>
                    <button onclick="downloadPDF()" class="btn btn-success px-5 fw-bold rounded-pill">TÉLÉCHARGER</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL SUCCÈS -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 rounded-4 text-center p-4">
                <i class="bi bi-check-circle-fill text-success mb-3" style="font-size: 3rem;"></i>
                <h3 class="fw-900">EXPORTÉ !</h3>
                <button onclick="resetInvoice()" class="btn btn-success btn-lg rounded-pill fw-bold w-100">CONTINUER</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="js/script.js"></script>
</body>
</html>